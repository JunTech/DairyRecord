---
title: 虚拟机运行时栈帧信息
author: Juntech
top: false
cover: false
toc: true
mathjax: false
copyright: true
summary: 虚拟机运行时栈帧信息
categories: jvm
tags: jvm
keywords: 栈帧
abbrlink: e9dc0470
date: 2019-09-24 15:11:55
---

## 运行时栈帧结构：

![](http://img.vim-cn.com/74/dee3a65361aeccb03e50833f6bb46b6179a326.png)

### 局部变量表：

存储方法参数与方法内部定义的局部变量。

 以变量槽slot为最小单位。未规定slot的大小，仅建议slot能够容纳，boolean，byte,char,short,int,float,reference\(对象实例的引用\),returnAddress（古老的jvm异常处理时使用）.

 64位数据，虚拟机使用高位对齐分配联系两个联系的slot的。

 建立在线程的堆上，是线程安全的。

 尽可能节约空间，slot是复用的。（若一个局部变量已不使用，没有其他变量需要占用slot，则不回收）

```
public static void main(String[] args){
{
byte[] bytes=new byte[64*1024*1024]
}
//有这就int a=0；才会回收之前使用的内存，因为slot是复用的。
int a=0;
System.gc();
}
```

### 操作数栈：

方法执行中，各种字节码指令会出栈入栈。

32位1个栈空间，64位2个栈空间。

一般与局部变量表公用地址

![](http://img.vim-cn.com/0f/1bbf366972a9d612fd42076c6a7b228a9f63d1.png)

### 动态链接：

每个帧栈都有一个指向运行时常量池中该帧栈所属方法的引用，持有这个引用 就是为了支持方法调用过程中的动态链接。

Class文件的常量池中有大量的符号引用。类加载时第一次使用就转化为直接引用，这种转化为静态解析。另外一部分将在每一次运行期转化为直接引用，这部分称为动态连接。

### 返回地址：

方法有2中返回方式：

1.正常退出，2异常退出。

无论哪种都需要返回到方法调用的位置，方法返回时需要保存一部分信息。

### 附加信息：

虚拟机实现加入的虚拟机规范中不存在的部分，即自定义栈信息。

